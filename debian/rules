#!/usr/bin/make -f

%:
	dh $@ --with phpcomposer

override_dh_auto_build:
	dh_auto_build
	# Also _RUN_ composer install. This is directly AGAINST Debian Policy ยง4.9 "For packages in the main archive, no required targets may attempt network access." 
	echo "Y" | composer install

override_dh_install:
	dh_install
	# Cleanup superfluous files
	find $(CURDIR)/debian/passbolt-api/ -type f \( -name '.git*' -o -iname 'license*' \) -delete
	# All JS goes in libjs-passbolt-embedded
	rm -Rf $(CURDIR)/debian/passbolt-api/usr/share/php/passbolt-api/webroot/js/app

override_dh_fixperms:
	dh_fixperms
	chown -R www-data $(CURDIR)/debian/passbolt-api/var/lib/passbolt

override_dh_auto_clean:
override_dh_auto_build:
